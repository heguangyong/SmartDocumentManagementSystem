
---

# 网盘后台管理系统主要功能测试用例

## 1. 存储桶管理

### 1.1 分页查询所有存储桶（含容量、人数等）

````markdown
**用例编号**：BKT-001  
**接口路径**：POST /api/bucket/admin/page  
**功能描述**：管理员分页查询所有存储桶  
**前置条件**：已登录管理员账户  
**测试数据**：
```json
{
  "pageNo": 1,
  "pageSize": 10,
  "searchKey": "test"
}
**预期结果**：

* 返回分页列表，包含存储桶名称、容量、用户数等信息
* 状态码 200

````

---

### 1.2 列出某个桶的用户权限（含来源）

```markdown
**用例编号**：BKT-002  
**接口路径**：GET /api/bucket/admin/{bucketId}/users  
**功能描述**：查看指定存储桶的用户权限  
**前置条件**：已登录管理员账户，bucketId 有效  
**测试数据**：
bucketId: 1001  
**预期结果**：
- 返回该存储桶下所有用户的权限列表，含来源信息
- 状态码 200
````

---

### 1.3 批量为桶分配用户权限

````markdown
**用例编号**：BKT-003  
**接口路径**：POST /api/bucket/admin/assign-permissions  
**功能描述**：管理员批量分配桶权限  
**前置条件**：已登录管理员账户，桶存在  
**测试数据**：
```json
{
  "bucketId": 1001,
  "permissions": [
    {
      "userId": 2001,
      "permission": ["READ", "WRITE"]
    },
    {
      "userId": 2002,
      "permission": ["READ"]
    }
  ]
}

**预期结果**：

* 分配成功，状态码 200
* 再次查询时权限与设置一致

````

---

### 1.4 移除用户对桶的访问权限

```markdown
**用例编号**：BKT-004  
**接口路径**：POST /api/bucket/admin/remove-permission  
**功能描述**：移除指定用户对存储桶的权限  
**前置条件**：已登录管理员账户，用户和桶存在  
**测试数据**：
```json
{
  "bucketId": 1001,
  "userId": 2002
}

**预期结果**：

* 删除成功，状态码 200
* 再次查询该用户权限时为空

````

---

### 1.5 更新桶容量配置

```markdown
**用例编号**：BKT-005  
**接口路径**：PUT /api/bucket/admin/{bucketId}/capacity  
**功能描述**：更新存储桶容量限制  
**前置条件**：已登录管理员账户，桶存在  
**测试数据**：
bucketId: 1001  
```json
{
  "maxCapacity": 104857600
}

**预期结果**：

* 修改成功，状态码 200
* 再次查询容量时数值更新

````

---

### 1.6 管理员创建新的存储桶

```markdown
**用例编号**：BKT-006  
**接口路径**：POST /api/bucket/admin/create  
**功能描述**：管理员新建存储桶  
**前置条件**：已登录管理员账户  
**测试数据**：
```json
{
  "bucketName": "project-data",
  "maxCapacity": 52428800
}

**预期结果**：

* 创建成功，状态码 200
* 新桶出现在桶列表中

````

---

### 1.7 管理员更新桶详细信息

```markdown
**用例编号**：BKT-007  
**接口路径**：PUT /api/bucket/admin/update/{id}  
**功能描述**：修改存储桶信息（名称、描述等）  
**前置条件**：已登录管理员账户，桶存在  
**测试数据**：
id: 1001  
```json
{
  "bucketName": "project-archive",
  "description": "Archived project files"
}

**预期结果**：

* 修改成功，状态码 200
* 再查询时信息更新

````

---

### 1.8 管理员删除指定存储桶

```markdown
**用例编号**：BKT-008  
**接口路径**：DELETE /api/bucket/admin/delete/{id}  
**功能描述**：删除指定存储桶  
**前置条件**：已登录管理员账户，桶存在且无重要文件  
**测试数据**：
id: 1001  
**预期结果**：
- 删除成功，状态码 200
- 列表中无此桶
````

---

## 2. 文件管理

### 2.1 文件上传

```markdown
**用例编号**：FILE-001  
**接口路径**：POST /api/file/upload  
**功能描述**：用户上传文件到指定存储桶路径  
**前置条件**：用户已登录，拥有上传权限  
**测试数据**：  
Content-Type: multipart/form-data  
- file: test.txt  
- bucketId: 123  
- targetPath: /documents/reports/

**测试步骤**：  
1. 进入文件列表页面  
2. 上传文件（指定存储桶路径）  

**预期结果**：  
* 文件上传成功  
* 返回文件元信息（文件名、大小、路径、上传时间）  
* 文件列表正确显示新上传文件  
* 状态码 200  

**安全需求**：真实性、完整性
```

---

### 2.2 文件共享

````markdown
**用例编号**：FILE-002  
**接口路径**：POST /api/file-permission/share/assign  
**功能描述**：用户为文件分配共享权限  
**前置条件**：用户已登录，拥有共享权限  
**测试数据**：
```json
{
  "fileId": 456,
  "targetUserId": 789,
  "permissions": ["READ", "WRITE"]
}
```

**测试步骤**：  
1. 在文件列表中选择文件  
2. 调用共享权限分配接口，选择目标用户并分配权限  
3. 保存配置  

**预期结果**：  
* 权限正确赋予目标用户  
* 权限来源正确显示（继承/个性化）  
* 状态码 200  

**安全需求**：真实性、机密性、完整性
````

---

### 2.3 文件移动

````markdown
**用例编号**：FILE-003  
**接口路径**：PUT /api/file/move  
**功能描述**：用户移动文件到目标目录  
**前置条件**：用户已登录，拥有移动权限  
**测试数据**：
```json
{
  "fileId": 456,
  "targetFolderId": 789,
  "libraryCode": "LIB001"
}
```

**测试步骤**：  
1. 选择一个文件  
2. 调用文件移动接口，指定目标路径  
3. 确认接口返回  

**预期结果**：  
* 文件移动成功  
* 文件在新路径可访问  
* 原路径文件不再存在  
* 状态码 200  

**安全需求**：真实性、完整性
````

---

### 2.4 文件访问日志验签

```markdown
**用例编号**：FILE-004  
**接口路径**：GET /api/file-access-log/{fileId}  
**功能描述**：获取文件访问日志并验签  
**前置条件**：系统已开启访问日志记录  
**测试数据**：
- fileId=456

**测试步骤**：  
1. 调用接口获取指定文件访问日志  
2. 校验返回日志的签名有效性  

**预期结果**：  
* 日志验签通过  
* 日志数据未被篡改  
* 返回访问时间、访问用户、操作类型等日志详情  
* 状态码 200  

**安全需求**：机密性、完整性
```

## 3. 用户管理

### 3.1 用户列表加载

```markdown
**用例编号**：USR-001  
**接口路径**：GET /api/user/list （全量）
  GET /list/filter （根据角色等条件分页用户信息）
  GET /cached （分页查询缓存用户信息,支持模糊搜索缓存用户信息）需调用第三方API接口，无法测试。

**功能描述**：管理员获取所有用户列表  
**前置条件**：管理员已登录  
**测试数据**：
-libraryCode=“XXX”

**预期结果**：
* 返回所有用户信息列表，包括用户名、角色、所属馆点、创建时间等
* 状态码 200
* 数据真实性、机密性得到保障
```
---

### 3.2 用户资源权限配置

```markdown
**用例编号**：USR-002  
**接口路径**：
- 查询权限：GET /api/user/{id}/permissions
- 更新权限：POST /api/user/{id}/permissions  
  **功能描述**：管理员查看和修改指定用户资源权限  
  **前置条件**：管理员已登录，目标用户存在  
  **测试数据**：

- 查询请求：用户ID路径参数
- 更新请求体示例：
[
  {
    "resourceType": "bucket",
    "resourceId": 1001,
    "permissions": ["read", "write"]
  },
  {
    "resourceType": "file",
    "resourceId": 2002,
    "permissions": ["read"]
  }
]


**测试步骤**：
1. 管理员调用GET接口查询用户权限
2. 管理员编辑权限后调用POST接口提交更新
3. 系统保存并返回操作结果

**预期结果**：
* 查询返回用户当前资源权限列表，状态码200
* 更新成功，返回操作成功提示，状态码200
* 权限来源更新为个性化
* 数据真实性、机密性、完整性保证
```

---

### 3.3 身份鉴别信息验证（登录）

```markdown
**用例编号**：USR-003  
**接口路径**：POST /api/user/login  
**功能描述**：用户登录验证，包括正确和错误密码情况  
**前置条件**：用户已注册且存在于系统中  
**测试数据**：
-说明，下面示例中captchaId，captchaCode 由接口/api/user/captcha 获得。
- 登录成功请求体示例：
  {
  "username": "admin",
  "password": "admin123",
  "libraryCode": "DEFAULT",
  "captchaId": "30be04d5-b5f4-4776-a430-d8cd91be020e",
  "captchaCode": "1kin",
  "rememberMe": false
  }

- 登录失败（密码错误）请求体同上，密码为错误值

**测试步骤**：
1. 用户输入正确用户名、密码及验证码，调用登录接口
2. 用户输入错误密码，调用登录接口

**预期结果**：
* 正确凭证登录成功，返回JWT token，状态码200
* 错误凭证登录失败，返回401或403错误提示
* 多次失败触发账号锁定机制
* 验证码错误时返回400错误
* 审计日志记录登录成功与失败
* 安全需求：真实性、机密性
```
